<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>摇一摇功能</title>
    <script type="text/javascript">
    //Javascript
    </script>
</head>

<body>
    <p>用力摇一摇你手机</p>
    <audio style="display:block" id="musicBox" preload controls src="../music/msg.mp3" >
    </audio>
</body>
<script type="text/javascript">
(function() {
    var SHAKE_THRESHOLD = 3000;
    var last_update = 0;
    var x = y = z = last_x = last_y = last_z = 0;

    function init() {
        if (window.DeviceMotionEvent) {
            window.addEventListener('devicemotion', deviceMotionHandler, false);
        } else {
            alert('not support mobile event');
        }
                // media.load();
    }
        var media = document.getElementById("musicBox");
        media.load
();
    init();

    function deviceMotionHandler(eventData) {
        var acceleration = eventData.accelerationIncludingGravity;
        var curTime = new Date().getTime();
        if ((curTime - last_update) > 100) {
            var diffTime = curTime - last_update;
            last_update = curTime;
            x = acceleration.x;
            y = acceleration.y;
            z = acceleration.z;
            var speed = Math.abs(x + y + z - last_x - last_y - last_z) / diffTime * 10000;

            if (speed > SHAKE_THRESHOLD) {
                // alert("摇动了");
                // media.setAttribute("src", "../music/msg.mp3");
                // var media = document.getElementById("musicBox");
                // media.load();
                media.play();
            }
            last_x = x;
            last_y = y;
            last_z = z;
        }
    }

})();
</script>

</html>
